#!/usr/bin/env bash
set -euo pipefail

warn() { echo 1>&2 "WARNING:" "$@"; }

check_submodules() {
    count=$(git submodule status --recursive | sed -n -e '/^[^ ]/p' | wc -l)
    [ $count -eq 0 ] || {
        warn "$count Git submodules are not up to date"
        warn 'Run `git submodule update --init`?'
    }
}

####################################################################

export B8_PROJDIR=$(cd "$(dirname "$0")" && pwd -P)
t8dev="$B8_PROJDIR/t8dev/bin/t8dev"

cd "$B8_PROJDIR"
check_submodules
. ./pactivate -q

$t8dev buildtoolset asl
$t8dev aslauto exe/ src/
$t8dev pytest -- "$@"
